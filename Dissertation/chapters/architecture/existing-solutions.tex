\section{Существующие программные решения}

В данном разделе коротко описаны основные существующие
технические решения, дополняющие понятийный аппарат разрабатываемого
программного окружения в рамках рассматриваемой гибридной методологии.
%С точки зрения прикладного программирования, рассмотренные решения
%формируют основу технологического стека

\subsection{Программы прикладного уровня}

\subsubsection{ROOT}

ROOT~\cite{ROOT-framework} представляет собой специализированное
объектно-ориентированное программное окружение, разработанное в CERN
для обработки и анализа данных в области экспериментальной физики
высоких энергий. Архитектура ROOT построена вокруг иерархии классов,
рассчитанной на полный цикл работы с данными, включая файловый и
сетевой ввод/вывод, поддержку сериализации сложных объектов
посредством динамического полиморфизма, а также фильтрацию данных
средствами встроенного предметно-ориентированного языка~(TFormula).

Ключевой особенностью является интеграция интерпретатора C++~(CINT и Cling),
позволяющая сочетать динамическое выполнение кода с полным доступом
к \acrshort{api} окружения без необходимости предварительной компиляции
программ. Такая интерактивность, по замыслу авторов, должна обеспечивать
совмещение скорости разработки сценариев и выполнения высокопроизводительных
вычислений в едином окружении, развивая идею, предложенную в
рамках языка Smalltalk, — тесную интеграцию языка, среды
выполнения и среды разработки в единую систему посредством
обязательных механизмов интроспекции типов.

Системный дизайн ROOT ориентирован на работу с большими
объёмами и сложной структурой данных, что выражается в
поддержке специализированных форматов хранения, оптимизированных
под последовательное чтение и реализацию поисковых запросов
последовательным перебором, механизмах
эффективного последовательного доступа и выборки, а также в
развитой инфраструктуре статистических и графических инструментов.

При этом необходимо отметить в качестве основной архитектурной
особенности тот факт, что ROOT не предоставляет интерфейсов в классическом
смысле \acrshort{oop}, и с точки зрения типологии \acrshort{sw}
является скорее набором библиотек (а не <<фреймворком>>), то есть
не предполагает наличия сложных алгоритмов с обозначенными точками
расширения.

В рамках данной работы большой практический интерес
представляют отлаженные и хорошо
оптимизированные предметно-ориентированные компоненты ROOT
предоставляющие подсистему хранения и передачи данных, программные
модели различных гистограмм и инструменты для работы с ними,
некоторые численные алгоритмы, такие как универсальный генератор
\texttt{TFoam} или система численной минимизации \texttt{Minuit}.

\subsubsection{Geant4}

Geant4~\cite{allison-recent-g4-2016} представляет собой
объектно-ориентированный программный инструментарий, предназначенный для
моделирования прохождения частиц через вещество и применяемый в
экспериментальной физике частиц, космических исследованиях и
медицинской физике. Архитектура Geant4 основана на системе классов C++,
описывающих физические процессы, типы частиц, геометрию
детекторов, материалы и пользовательские действия.

Geant4 предоставляет обширный набор реализаций вероятностных
генераторов описывающих наибольшее количество известных на
сегодняшний момент процессов в физике частиц.

Его программная архитектура детально документирована и построена на основе
многостадийного алгоритма трассировки частиц с обозначенными точками
расширения, выраженными посредством интерфейсов в абстрактных
классах C++ -- в схеме классического <<фреймворка>> \acrshort{oop}.
Конфигурирование моделирования осуществляется в этих точках расширения
путём комбинирования предопределённых или пользовательских списков
физических процессов, задания конфигураций детекторов и определения источников первичных частиц, естественно опираясь на полиморфизм и наследование объектного
представления соответствующих классов-реализаций.

В рамках данной работы Geant4 рассматривается как основная среда для
моделирования методами Монте-Карло.

\subsubsection{GenFit2}

Библиотека GenFit2~\cite{Genfit2_Rauch_2015} предоставляет расширяемый
набор инструментов для реконструкции треков заряженных частиц
в экспериментах физики высоких энергий. Проект развивался
в сообществе экспериментов PANDA~\cite{panda-collaboration} и
Belle~II~\cite{belle-ii}. Основу библиотеки составляет реализация
фильтра Калмана~\cite{kalman-1960} и его модификаций,
применимых в условиях неоднородного
магнитного поля (пропагация ковариации методами Рунге-Кутты~\cite{StrandlieJacobians}) и
сложной геометрии детекторов (учёт множественного рассеяния и ионизации).
Поддерживается линейная и нелинейная аппроксимация формы фильтра
Калмана, реализованы процедуры итеративного уточнения трека (smoothing,
deterministic annealing filter).

Архитектурно GenFit2 опирается на собственную объектную модель события,
выделяя статическую и динамическую информацию о треке в раздельные классы
в тесной связи с формализмом фильтра Калмана. Таким образом, входные
данные представляются набором измеренных состояний (в терминах координат,
импульсов и их ковариационных матриц), а результат работы фильтра Калмана
содержится в динамических транзитивных объектах.

GenFit2 использует вокселизацию ROOT для представления карты вещества,
использует его систему типов для полиморфизма времени выполнения и использует
реализации методов Рунге-Кутты для трассировки ошибки (пропагации
ковариационных оценок) через карту магнитного поля.

Таким образом, инфраструктурно, библиотека экспонирует все свои интерфейсы в
пользовательский~\acrshort{api}, позволяя вмешиваться в основной процесс
реконструкции трека (подгонки). Так, в частности, реализован алгоритм
General Broken Line~\cite{gbp-kleinwort} для реконструкции трека,
не нарушающий основную логику библиотеки.

\subsubsection{MillipedeII}

В экспериментах нуждающихся в точной геометрической информации,
геодезические измерения зачастую и по разным причинам, неспособны обеспечить
необходимый уровень точности. В этой связи, особую актуальность имеет
задача геометрического выравнивания детекторов установки,
заключающаяся в уточнении их координат, углов поворота и различных
внутренних параметров (таких как, например, множители Лагранжа
при провисании анодных проволок в газоразрядных камерах) на основе
реконструированных треков. Существуют несколько различных подходов
к решению этой задачи, за которой закрепилось узкое понимание
термина \emph{выравнивание}~(англ. \emph{alignment}).

Millepede~II\cite{millipede-blobel2009} -- это специализированная
библиотека, предназначенная для выравнивания трековых детекторов.
Она решает задачу одновременного подбора \emph{глобальных} параметров
(геометрические положения и ориентации элементов детектора,
калибровочные константы) и \emph{локальных} параметров (параметры
отдельных треков частиц). Основная особенность метода
заключается в том, что задача сводится к решению большой
переобусловленной СЛАУ с блочной матрицей, где блоки, относящиеся
к локальным параметрам, могут быть исключены аналитически.
Таким образом достигается эффективная редукция размерности
задачи и возможность обращения матриц больших порядков.
Оригинальный численный метод обращения и итеративного
решения разреженных блочных матриц, предложенный
В. Блобелем, является ключевой инновацией Millepede II,
позволившей использовать его как стандартный инструмент
выравнивания во многих экспериментах (CMS, ATLAS, Belle II и др.).

\subsection{Инфраструктурные решения и экосистемы}

\subsubsection{Gaudi}

Gaudi~\cite{gaudi-framework-1} представляет собой модульное
объектно-ориентированное программное окружение, разработанное
в CERN для организации систем обработки данных в экспериментах
физики высоких энергий. В отличие от ROOT, архитектура Gaudi
изначально ориентирована не на полный цикл работы
с данными в рамках одного монолитного окружения, а на
построение приложений из набора взаимодействующих компонентов,
выполняющих функции ограниченные интерфейсом. Таким образом
архитектура выполнена в виде компонентной модели с чётко
определёнными интерфейсами задающими точки расширения.

Gaudi реализует инфраструктуру,
включающую управление жизненным циклом компонентов,
планирование и диспетчеризацию обработки событий, доступ к
условиям и метаданным, а также взаимодействие с системами
ввода-вывода. Прикладная логика оформляется в виде
алгоритмов и сервисов. Этапы конфигурирования и инициализации
приложения разделены.

Системный дизайн Gaudi опирается на модель события с динамической
интроспекцией, поддержку распределённых
вычислений (HTC) и интеграцию с внешними системами хранения,
базами данных.

Проект строится вокруг следующей классификации
источников данных, представленных в виде сервисов:
\begin{itemize}
    \item Сервис сообщений, предоставляющий
    интерфейс~\texttt{IMessageSvc}, реализующий задачи
    журналирования.
    
    \item Сервис данных события~(\texttt{EventDataSvc}),
    реализующий доступ к транзиентному хранилищу данных,
    разделяемом между алгоритмами в рамках обработки одного
    события. Сервис предоставляет унифицированный
    способ получения и размещения элементов объектной модели
    события.

    \item Сервис калибровочных данных, условий и геометрии
    детектора (\texttt{DetectorDataSvc}), предоставляющий
    статическую информацию о структуре детектора, его
    параметрах, а также условия проведения
    измерений.

    \item Сервис преобразования данных (\texttt{ConversionSvc}) и
    механизм сериализации/десериализации, обеспечивающие независимость
    логики реконструкции от конкретного формата хранения данных.

    \item Планировщик (\texttt{IScheduler},
    %или более современный \texttt{Gaudi::Hive::WhiteBoard})
    отвечающий за порядок вызова алгоритмов и управление
    их зависимостями на основе графа исполнения.
    %, что особенно
    %важно в условиях параллельной или многопоточной обработки событий.
\end{itemize}

В рамках данной работы Gaudi рассматривается в основном
в качестве ближайшей функциональной альтернативы.

\subsubsection{FairROOT}

FairRoot и FairSoft~\cite{fairroot-AlTurany-2012} образуют
\emph{экосистему} программного обеспечения, разработанную
в рамках FAIR (Facility for Antiproton and Ion Research,
GSI, Дармштадт, \cite{FAIR-techreport}) для моделирования,
реконструкции и анализа данных в современных экспериментах по
физике высоких энергий и ядерной физике.

Целью данного проекта является гарантия совместимости
инструментов объединённых в рамках общих протоколов и форматов.
Так, например, ROOT и Geant4 имеют не вполне совместимые системы
описания конструктивной полнотелой геометрии и используют
разные алгоритмы вокселизации. С целью решения этой проблемы
авторы проекта вводят дополнительный слой абстракции реализованный
в выделенной библиотеке VNC (Virtual Monte-Carlo) и специализируют
его интерфейсы в расширенном описании в рамках собственных обобщающих
программных моделей.

Поскольку подобная активность всегда связана с поиском компромиссов
между активно меняющимися программами, разрабатываемыми третьими
лицами, необходимо подобное начинание требует утверждения версий
проектов включённых в такую экосистему. FairSoft -- это набор
(\emph{программный стэк}), включающий внешний набор библиотек и
инструментов, необходимых для работы FairRoot. В неё входят
ROOT, Geant4, VMC, интсрументы сериализации и удалённого вызова
процедур. FairSoft призван обеспечивать стандартизированное
и согласованное окружение.

Создание такой экосистемы продиктовано потребностью
крупных коллабораций (например, PANDA, CBM, R3B на FAIR,
а также ряде других экспериментов в Европе и за её пределами)
в едином, воспроизводимом и модульном программном окружении,
объединяющем моделирование, реконструкцию и анализ в стабильной
форме.
