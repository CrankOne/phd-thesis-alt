\section{Спецификации}

Описанные в данной главе принципы можно свести в перечень
спецификаций, которым должна отвечать система реализующая
программное окружение для обработки экспериментальных
данных с тем.

\subsection{Обработка данных}

Обобщённая реализация конвейерного шаблона проектирования, опирающегося
на модель физического события представляет собой универсальный компонент
для систем обработки данных эксперимента с триггерной
системой.

С учётом изложенных ограничений на модель события,
описание составного типа данных должно включать:
\begin{itemize}
    \item Имя типа -- строковый идентификатор совместимый
    с определением типа в C++ и стандартом именованием таблиц
    в \acrshort{dbms}.
    \item Список атрибутов (полей), состоящий из,
    упорядоченного набора кортежей из трёх элементов, включающих
    имя, тип данных и описание атрибута. Имя атрибута
    должно быть совместимо с определением атрибутов структур в C++.
    Тип атрибута должен соответствовать множеству типов для которых в
    программном окружении (средствами статического полиморфизма) определены
    основные операции конверсии, серелиазции и десериализации.
\end{itemize}
Дополнительно, описание составного типа данных может включать:
\begin{itemize}
    \item Документацию к типу,
    \item Родительский тип,
    \item Список динамических (выводимых) атрибутов типа.
\end{itemize}

На основе такой спецификации типов, для набора типов,
среди которых указан один корневой (хранимого события) должны
выводиться следующие объявления и реализации:
\begin{enumerate}
    \item Объявление всех типов данных (в C++ -- декларации классов)
    \item Для реализации процедур на основе статического
    полиморфизма -- объявление
    шаблонных свойств объявленных типов (англ. \emph{template traits}) для
    перебора атрибутов, с указанием имени атрибута, типа, порядкового
    номера,
    \item Интерфейс источника данных реализующий генератор
    экземпляров корневого типа (в случае C++ -- базовый класс
    источника данных),
    \item Интерфейс реализующий конвейерный шаблон
    относительно корневого типа и его реализацию (перебор событий
    с обратной связью от обработчиков),
    \item Интерфейсы обработчиков экземпляров типов данных (англ. \emph{handler}),
    в частности интерфейс обработчика данных принимающих экземпляр
    корневого типа (в случае C++ -- базовый класс обработчика
    событий).
\end{enumerate}

Требование №2 связано с тем, что в C++ на уровне семантики шаблонов
(и, вообще, в рамках стандартных средств языка)
отсутствуют средства для перебора набора полей структуры или класса
в виде набора кортежей (имя, тип). Если каким-либо образом предоставить
такую информацию, возникает возможность определять рекурсивные
метафункции, способные обходить всю иерархию типов во время компиляции.
В частности, если для всех типов атрибутов определены
операции сереализации и десериализации, сериализуемость составного
типа реализуется процедурно, на основе шаблонных свойств.

\subsection{Калибровочные данные}

Обобщённая реализация интерфейсов доставки калибровочных данных
должна быть представлена в виде реализации шаблона <<издатель/подписчик>>.
Оба компонента выражаются явно, в виде классов.

Добавление нового типа калибровочных осуществляется средствами статического
полиморфизма -- на основе типа данных выводится реализация абстрактного
типа подписчика. Компоненты реализуют поведение подписчика посредством
динамического полиморфизма.

В случае зависимостей между типами данных, вычисление корректного порядка
оповещения подписчиков должно выполняться издателем.

\subsection{Цикл разработки}

Цикл разработки опирающийся на предложенные решение предполагает
инкрементную модель расширения функциональности, как это описано
в методологии feature-driven development. В рамках сравнительно
коротких циклов, круг задач, решаемых компонентом, место встраивания,
осуществляют прототипирование и реализацию функциональности, опираясь
на тестовую статистику. На завершающем этапе компонент (обработчик
конвейера или утилита) встраиваются в библиотеку модулей программного
окружения.

Критическими изменениями способными нарушить обратную совместимость
программного окружения являются изменения модели события. В этом случае
предложенный подход предусматривает создание автоматических сценариев
миграции данных за счёт явного предоставления интроспективной информации о
топологии типов объектной модели события.

\subsection{Реализация}

Реализация обобщённых решений выполнена с использованием
спецификации типов данных на языке разметки YAML~\cite{yaml-rfc9512},
на основе которой при помощи текстового шаблонизатора
Jinja2~\cite{jinja2-docs} генерируется набор
деклараций и реализаций типов данных. Реализации перечисленных
обобщённых алгоритмов выводятся на основе шаблонного кода.
